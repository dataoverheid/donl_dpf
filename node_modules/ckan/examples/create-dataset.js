var csv = require('csv')
  , _ = require('underscore')
  , ckan = require('../ckan')
  , Q = require('q')
  ;

// Your CKAN instance location
var endpoint = 'http://localhost:5000';
// TODO: set your API Key
var apiKey = 'tester';

var client = new ckan.Client(endpoint, apiKey);

var datasetInfo = {
  name: 'ckan-explorer',
  title: 'CKAN Explorer Data',
  resources: [{
    name: 'resource-1',
    url: 'http://ckan.org/',
    url_type: 'datastore'
  }]
};

// Upsert - Create dataset - or update if already exists
function createDataset(cb) {
  client.action('dataset_show', { id: datasetInfo.name }, function(err, out) {
    // dataset exists
    if (!err) {
      resourceId = out.result.resources[0].id;
      // client.action('dataset_update', datasetInfo, cb);
      cb();
    } else {
      client.action('dataset_create', datasetInfo, function(err, out) {
        resourceId = out.result.resources[0].id;
        cb(err, out);
      });
    }
  });
}

